{"pages":[{"title":"tags","text":"","link":"/tags/index.html"},{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"深度学习模型性能分析：计算能力与内存带宽","text":"前言阅读ComNet文章关于模型复杂度对比的表格时，一直不清楚intensity这一项代表的是啥。正巧搜索到了Momenta的技术分享以及相关笔记。经过一番研究，终于明白了intensity的含义，现在总结出来以便日后查阅。 计算平台的两个指标：算力$\\pi$与带宽$\\beta$ 算力$\\pi$：计算平台的性能上限，指的是一个计算平台每秒钟所能完成的最大浮点运算数。单位是FLOPS。（注意FLOPS与FLOPs的区别，前者全称为floating point operations per second，用于描述计算速度，后者全称为floating point operations，用于描述计算量） 带宽$\\beta$：计算平台的带宽上限，指的是一个计算平台每秒钟所能完成的最大内存交换量。单位是Byte/s。 运算强度上限$I_{\\mathrm{max}}$：上述两个指标相除即可得到计算平台的计算强度上限，指的是单位内存交换最多用来进行多少次计算。单位是FLOPs/Byte。 $$I_{\\mathrm{max}}=\\frac{\\pi}{\\beta}$$ 注：这里说的”内存“指广义上的内存。对于CPU计算平台而言指的是真正的内存，而对于GPU计算平台指的是显存。 模型的两个指标：计算量与访存量 计算量：指的是输入单个样本（对于CNN而言就是一张图像），模型进行一次完整的前向传播所发生的浮点运算个数，也即模型的时间复杂度，单位是FLOPs。 访存量：指的是输入单个样本，模型完成一次前向传播过程中所发生的内存交换总量，也即模型的空间复杂度。在理想情况下（即不考虑片上缓存），模型的访存量就是模型各层权重参数的内存占用与每层所输出的特征图的内存占用，单位是Byte。由于数据类型通常为float32，因此需要乘以4。==（是否需要考虑输入特征图的内存占用呢？）== 模型的运算强度$I$：算法对于内存带宽的需求通常用operational intensity，由计算量除以访存量就可以得到模型的计算强度，单位是FLOPs/Byte。它表示此模型在计算过程中，每Byte内存交换支持进行多少次浮点运算。运算强度越大，其内存使用效率越高。 模型的理论性能$P$：最关心的指标，即模型在计算平台上所能达到的每秒浮点运算次数（理论值），单位是FLOPS。下面介绍的Roofline Model给出计算这个指标的方法。 Roofline ModelRoofline Model想传达的事情是：模型在一个计算平台的限制下，到底能达到多快的浮点计算速度。更具体点来说，Roofline Model解决的是计算量为A且访存量为B的模型在算力为C且带宽为D的计算平台所能达到的理论性能上限E是多少这个问题。 Roofline的形态所谓Roofline，指的是由计算平台的算力和带宽上限这两个参数所决定的“屋顶”形态，如上图所示。坐标轴分别是计算性能（纵轴）和算法的运算强度（横轴）。 算力决定“屋顶”的高度（绿色线段） 带宽决定“房檐”的斜率（红色线段） Roofline划分出的两个瓶颈区域$$P=\\left{\\begin{array}{ll}{\\beta \\cdot I,} &amp; {\\text { when } I&lt;I_{\\text {max}} \\quad {\\text{Bandwidth Bound}} } \\ {\\pi,} &amp; {\\text { when } I \\geq I_{\\text {max}} \\quad { \\text{Computation Bound }}}\\end{array}\\right.$$ 带宽瓶颈区域（Bandwidth Bound） 当运算强度较小时，曲线处于左边的上升区，即计算性能实际被内存带宽限制，有很多计算处理单元是闲置的。随着算法运算强度上升，在相同数量的数据下算法可以完成更多运算，于是闲置的运算单元越来越少，这时候计算性能就会上升。我们把$I&lt;I_{\\text{max}}$的区域称为带宽瓶颈区域。 计算瓶颈区域（Computation Bound） 随着运算强度越来越高，闲置的计算单元越来越少，最后所有计算单元都被用上了，Roofline曲线就进入了右边的饱和区，即使运算强度不断增大，也没有更多的计算单元可用了，于是计算性能不再上升。我们把$I\\geq I_{\\text{max}}$的区域称为计算瓶颈区域。 参考文章 Roofline Model与深度学习模型的性能分析 内存带宽与计算能力，谁才是决定深度学习执行性能的关键？","link":"/2019/07/07/【深度学习】从两个角度分析深度学习模型性能/"}],"tags":[{"name":"deep learning","slug":"deep-learning","link":"/tags/deep-learning/"}],"categories":[]}